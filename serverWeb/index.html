<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src=/socket.io/socket.io.js></script>
    <script src=https://code.jquery.com/jquery-1.9.1.min.js></script>
    <script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <script>
        
        var lstrgSocketidClient;
        var socket = io.connect();
        
        socket.on('pong-um', function(recebe){
            
            if(recebe.sessionid){
                socket.emit('ping-um', recebe);
            }else{
                socket.emit('ping-um', {"sessionid":socket.id}); 
            }
                        
        });             

        socket.on('ligar', function(objSocketidClient){

            //Aqui é o pulo do gato!
            if(socket.id === objSocketidClient.sessionid){
                
                $('#log').html($('#log').html() + '<br>' + 'On ' + Date());
                /*
                // envia um post maroto local service node.js ajax
                $.ajax ({
                    url: adressLocal,
                    type: "POST",
                    data: JSON.stringify({data:"test"}),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function(lblLigou){
                        if(lblLigou.acendeu)
                            //alert('Acendeu');
                            $('#log').html($('#log').html() + '<br>' + 'Acendeu ' + Date());
                    }
                }); 
                */           
            };      
        }); 
        
        socket.on('pong-id', function(objSocketidClient){
            
            if(objSocketidClient){
                if(objSocketidClient.sessionid){
                    $('#btnEnviarId').hide();
                    $('#btnErase').hide();
                    $('#mensagem').text('Instância client remoto Execute uma ação abaixo:');   
                };                   
            }    
   

        });         

    
        $(function(){
            
            $('#btnEnviarId').click(function(){
                socket.emit('ping-um', {"sessionid":null});
                $('#btnEnviarId').hide();
                $('#btnErase').show();
                return false;
            });
            
            $('#btnLigar').click(function(){
                socket.emit('ligar', null);
                return false;
            });                           
            
            $('#btnErase').click(function(){
                socket.emit('erase', socket.id);
                return false;
            });            
            
            socket.emit('ping-id', null);

            //$('#btnErase').hide();
            //$('#btnEnviarId').hide();      
            $('#mensagem').text('Instância client/server não fechar essa aba do navegador. App socket rodando...');  
            
        });
    
    </script>
  </head>
  <body>
    <div class="container-fluid">
        <p id="mensagem"></p>
        <input type="button" class="btn btn-primary btn-large" value="EraseData" id="btnErase" >
        <input type="button" class="btn btn-primary btn-large" value="Autenticar id servidor" id="btnEnviarId" >
        <input type="button" class="btn btn-primary btn-large" value="Ligar" id="btnLigar" >
        <p id="log"></p>
    </div>
  </body>
</html>